!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HlsProxy=t():e.HlsProxy=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/src/",t(t.s=3)}([function(e,t,r){"use strict";e.exports=r(4)},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function n(e){if(e>b)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=o.prototype,t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}return i(e,t,r)}function i(e,t,r){if("string"==typeof e)return f(e,t);if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":m(e)));if(g(e,ArrayBuffer)||e&&g(e.buffer,ArrayBuffer))return l(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var i=h(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":m(e)))}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e,t,r){return a(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}function s(e){return a(e),n(e<0?0:0|p(e))}function f(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|d(e,t),i=n(r),a=i.write(e,t);return a!==r&&(i=i.slice(0,a)),i}function c(e){for(var t=e.length<0?0:0|p(e.length),r=n(t),o=0;o<t;o+=1)r[o]=255&e[o];return r}function l(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),n.__proto__=o.prototype,n}function h(e){if(o.isBuffer(e)){var t=0|p(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}return void 0!==e.length?"number"!=typeof e.length||v(e.length)?n(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}function p(e){if(e>=b)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+b.toString(16)+" bytes");return 0|e}function d(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||g(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+(void 0===e?"undefined":m(e)));var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;default:if(i)return n?-1:y(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t){t=t||1/0;for(var r,n=e.length,o=null,i=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function g(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function v(e){return e!==e}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.Buffer=o;var b=2147483647;t.kMaxLength=b,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.from=function(e,t,r){return i(e,t,r)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,t,r){return u(e,t,r)},o.allocUnsafe=function(e){return s(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(g(a,Uint8Array)&&(a=o.from(a)),!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var a=i-1;a>=0;--a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),u=n(a),s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(6),c=r(8),l=n(c),h=r(9),p=n(h),d=r(11),y=n(d),g=r(13),v=r(2).Buffer,m=["m3u8"],b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var r=Object.assign({},f.defaultPloxyConfig,t);this.config=r,this.hlsMediaFiles=this.config.hlsMediaFiles,this.mediaFileLoadTimeout=this.config.mediaFileLoadTimeout,this.client=null,this.msgClient=new l.default;var n=new p.default(r.logLevel);r.logger=this.logger=n}return s(e,[{key:"onActivate",value:function(){function e(e){return t.apply(this,arguments)}var t=o(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));return e}()},{key:"onFetch",value:function(){function e(e){return t.apply(this,arguments)}var t=o(u.default.mark(function e(t){var r,n,o,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.logger,n=t.request,"GET"===n.method){e.next=4;break}return e.abrupt("return");case 4:if(o=n.url,i=(0,g.getUrlSuffix)(o),!m.includes(i)){e.next=9;break}return r.info(t.request.url),e.abrupt("return",t.respondWith(this.handlePlaylistRequest(n)));case 9:if(!this.hlsMediaFiles.includes(i)){e.next=12;break}return r.info(t.request.url),e.abrupt("return",t.respondWith(this.handleMediaRequest(n)));case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"handlePlaylistRequest",value:function(e){var t=this,r=this.logger;return fetch(new Request(e.url,{mode:"cors"})).then(function(){var n=o(u.default.mark(function n(i){return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!i.ok){n.next=13;break}return n.t0=t.msgClient,n.t1=y.default.SW_PLAYLIST,n.t2=e.url,n.next=6,i.clone().text();case 6:n.t3=n.sent,n.t4={url:n.t2,text:n.t3},n.t5={action:n.t1,data:n.t4},n.t6=300,n.t7=function(){var e=o(u.default.mark(function e(r){var n,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.client,o=r.data,e.next=3,t.msgClient.isClientAlive(n);case 3:if(!e.sent){e.next=5;break}t.client=n;case 5:o.debug?t.logger.enableDebug():t.logger.resetLogger();case 6:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}(),n.t8=function(e){r.warn(e),t.client=null},n.t0.sendMessageToAllClients.call(n.t0,n.t5,n.t6).then(n.t7).catch(n.t8);case 13:return n.abrupt("return",i);case 14:case"end":return n.stop()}},n,t)}));return function(e){return n.apply(this,arguments)}}())}},{key:"handleMediaRequest",value:function(){function e(e){return t.apply(this,arguments)}var t=o(u.default.mark(function e(t){var r,n,i,a,s,f,c,l,h=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.logger,n=t.headers,i=t.url,a=n.get("range")||void 0,s=(0,g.parseRangeHeader)(a),f=s.start,c=s.end,!f||c!==f){e.next=6;break}return e.abrupt("return");case 6:if(l=function(){r.info("request "+t.url+" from network");var e=(0,g.makeHeadersWithRange)(a);return fetch(new Request(t.url,{headers:e,mode:"cors"})).then(function(){var e=o(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok||!h.client){e.next=14;break}return e.t0=h.msgClient,e.t1=h.client,e.t2=y.default.SW_MEDIA,e.t3=i,e.next=7,t.clone().arrayBuffer();case 7:e.t4=e.sent,e.t5=a,e.t6={url:e.t3,buffer:e.t4,range:e.t5},e.t7={action:e.t2,data:e.t6},e.t8=1e3,e.t9=function(e){r.warn(e)},e.t0.sendMessageToClient.call(e.t0,e.t1,e.t7,e.t8).catch(e.t9);case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}},e,h)}));return function(t){return e.apply(this,arguments)}}())},!this.client){e.next=11;break}return e.abrupt("return",this.msgClient.sendMessageToClient(this.client,{action:y.default.SW_GET_MEDIA,data:{url:i,range:a}},this.mediaFileLoadTimeout).then(function(){var e=o(u.default.mark(function e(t){var n,o,a,s,p;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.data)||!n.buffer){e.next=14;break}if(o=n.buffer,a=n.incomplete,r.info("hit cache "+i),s=void 0,a){e.next=9;break}s=n.buffer,e.next=12;break;case 9:return e.next=11,h.loadRemainBufferByHttp(i,o,f,c);case 11:s=e.sent;case 12:return p=f?{status:206,statusText:"Partial Content",headers:[["Content-Range","bytes "+f+"-"+c+"/"+s.byteLength]]}:{status:200,statusText:"ok"},e.abrupt("return",new Response(s,p));case 14:return e.abrupt("return",l());case 15:case"end":return e.stop()}},e,h)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return r.warn(e),l()}));case 11:r.warn("client not exist when get media");case 12:return e.abrupt("return",l());case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"onMessage",value:function(){function e(e){return t.apply(this,arguments)}var t=o(u.default.mark(function e(t){var r,n,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ports[0]){e.next=2;break}return e.abrupt("return");case 2:r=t.data,this.logger.info("SW Received Message: "+JSON.stringify(r)),n=r.action,o={},t.source.postMessage(o);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"register",value:function(){self.addEventListener("install",function(e){}),self.addEventListener("activate",this.onActivate.bind(this)),self.addEventListener("fetch",this.onFetch.bind(this)),self.addEventListener("message",this.onMessage.bind(this))}},{key:"loadRemainBufferByHttp",value:function(e,t,r,n){var o=this,i=this.logger,a=this.msgClient,u="bytes=";return r?(i.info("rangeStart "+r+" rangeEnd "+n),u=""+u+(r+t.byteLength)+"-"+n):u=""+u+t.byteLength+"-",i.info("continue download from "+e+" range: "+u),fetch(e,{headers:{Range:u},mode:"cors"}).then(function(e){return e.arrayBuffer()}).then(function(u){var s=void 0;r&&(s="bytes="+r+"-"+n);var f=v.from(u),c=v.concat([t,f]),l=new Uint8Array(c).buffer;return a.sendMessageToClient(o.client,{action:y.default.SW_MEDIA,data:{url:e,buffer:l,range:s}},1e3).catch(function(e){i.warn(e)}),l}).catch(function(e){o.logger.error("http partial download error "+e)})}}]),e}();t.default=b,b.version="0.1.1",e.exports=t.default},function(e,t,r){"use strict";var n=function(){return this}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(5),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t,r){"use strict";(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(r){function n(e,t,r,n){var o=t&&t.prototype instanceof i?t:i,a=Object.create(o.prototype),u=new d(n||[]);return a._invoke=c(e,r,u),a}function o(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function i(){}function a(){}function u(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function f(e){function r(n,i,a,u){var s=o(e[n],e,i);if("throw"!==s.type){var f=s.arg,c=f.value;return c&&"object"===(void 0===c?"undefined":t(c))&&b.call(c,"__await")?Promise.resolve(c.__await).then(function(e){r("next",e,a,u)},function(e){r("throw",e,a,u)}):Promise.resolve(c).then(function(e){f.value=e,a(f)},u)}u(s.arg)}function n(e,t){function n(){return new Promise(function(n,o){r(e,t,n,o)})}return i=i?i.then(n,n):n()}var i;this._invoke=n}function c(e,t,r){var n=S;return function(i,a){if(n===T)throw new Error("Generator is already running");if(n===x){if("throw"===i)throw a;return g()}for(r.method=i,r.arg=a;;){var u=r.delegate;if(u){var s=l(u,r);if(s){if(s===P)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===S)throw n=x,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=T;var f=o(e,t,r);if("normal"===f.type){if(n=r.done?x:A,f.arg===P)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(n=x,r.method="throw",r.arg=f.arg)}}}function l(e,t){var r=e.iterator[t.method];if(r===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,l(e,t),"throw"===t.method))return P;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var n=o(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,P;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,P):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,P)}function h(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function p(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function d(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)}function y(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(b.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=v,t.done=!0,t};return n.next=n}}return{next:g}}function g(){return{value:v,done:!0}}var v,m=Object.prototype,b=m.hasOwnProperty,w="function"==typeof Symbol?Symbol:{},E=w.iterator||"@@iterator",_=w.asyncIterator||"@@asyncIterator",R=w.toStringTag||"@@toStringTag",L="object"===t(e),C=r.regeneratorRuntime;if(C)return void(L&&(e.exports=C));C=r.regeneratorRuntime=L?e.exports:{},C.wrap=n;var S="suspendedStart",A="suspendedYield",T="executing",x="completed",P={},D={};D[E]=function(){return this};var O=Object.getPrototypeOf,k=O&&O(O(y([])));k&&k!==m&&b.call(k,E)&&(D=k);var I=u.prototype=i.prototype=Object.create(D);a.prototype=I.constructor=u,u.constructor=a,u[R]=a.displayName="GeneratorFunction",C.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},C.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,R in e||(e[R]="GeneratorFunction")),e.prototype=Object.create(I),e},C.awrap=function(e){return{__await:e}},s(f.prototype),f.prototype[_]=function(){return this},C.AsyncIterator=f,C.async=function(e,t,r,o){var i=new f(n(e,t,r,o));return C.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},s(I),I[R]="Generator",I[E]=function(){return this},I.toString=function(){return"[object Generator]"},C.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},C.values=y,d.prototype={constructor:d,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(p),!e)for(var t in this)"t"===t.charAt(0)&&b.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return i.type="throw",i.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=b.call(o,"catchLoc"),u=b.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&b.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,P):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),P},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),p(r),P}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;p(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:y(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),P}}}(function(){return this}()||Function("return this")())}).call(t,r(1)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPloxyConfig=t.defaultP2PConfig=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(7),i=function(e){return e&&e.__esModule?e:{default:e}}(o),a=n({},i.default,{swFile:"sw.js",swScope:"./",httpLoadTime:2,nativePlaybackOnly:!1});a.segmentId=function(e,t,r,n){var o=r.split("?")[0];return o.startsWith("http")&&(o=o.split("://")[1]),n?o+"|"+n:""+o};var u={mediaFileLoadTimeout:4500,logLevel:"error",hlsMediaFiles:["ts","mp4","m4s"]};t.defaultP2PConfig=a,t.defaultPloxyConfig=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={wsMaxRetries:10,p2pEnabled:!0,wifiOnly:!1,memoryCacheLimit:{pc:1073741824,mobile:536870912},dcDownloadTimeout:25,logLevel:"error",tag:"",webRTCConfig:{},token:void 0,appName:void 0,appId:void 0,prefetchNum:8,showSlogan:!0,trickleICE:!1,simultaneousTargetPeers:2,announceLocation:"cn",scheduleLevel:void 0};n.validateSegment=function(e,t){return!0},n.getStats=function(e,t,r){},n.getPeerId=function(e){},n.getPeersInfo=function(e){},t.default=n,e.exports=t.default},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(){function e(){o(this,e),this.sendMessageToClient=this.sendMessageToClient.bind(this),this.sendMessageToAllClients=this.sendMessageToAllClients.bind(this)}return u(e,[{key:"sendMessageToClient",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=n(a.default.mark(function e(t,r,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,o){if(!t)return void o("client is null");var i=new MessageChannel;i.port1.onmessage=function(r){e({client:t,data:r.data.data})},i.port1.onmessageerror=function(e){o(e)},t.postMessage(r,[i.port2]),setTimeout(function(){i.port1.close(),i.port2.close(),o("MessageChannel "+r.action+" timed out after "+n+" ms")},n)}));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"sendMessageToAllClients",value:function(){function e(e,r){return t.apply(this,arguments)}var t=n(a.default.mark(function e(t,r){var n,o=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,clients.matchAll();case 2:return n=e.sent,e.abrupt("return",Promise.race(n.map(function(e){return o.sendMessageToClient(e,t,r)})));case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"isClientAlive",value:function(){function e(e){return t.apply(this,arguments)}var t=n(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return e.abrupt("return",clients.matchAll().then(function(e){return e.some(function(e){return e.id===t.id})}));case 3:case"end":return e.stop()}},e,this)}));return e}()}]),e}();t.default=s,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(10),a={debug:0,info:1,warn:2,error:3,none:4},u=function(){function e(t){n(this,e),this.logLevel=t,this.onlineDebug=!1,console.debug=console.log,"debug"!==t&&"info"!==t||(this.logLevel="debug"),!0===t?this.logLevel="warn":!1===t?this.logLevel="none":t in a||(this.logLevel="error"),this.resetLogger()}return o(e,[{key:"enableDebug",value:function(){this.onlineDebug=!0;for(var e in a)this[e]=console[e]}},{key:"resetLogger",value:function(){this.onlineDebug=!1;for(var e in a)a[e]<a[this.logLevel]?this[e]=i.noop:this[e]=console[e]}},{key:"isDebugLevel",get:function(){return a[this.logLevel]<=1||this.onlineDebug}}]),e}();t.default=u,e.exports=t.default},function(e,t,r){"use strict";function n(){return!0}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(t);return null!=r&&""!==r[2]?r[2].toString():""}function i(e,t,r){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+t+"="+r+"$2"):e+o+t+"="+r}function a(){return Date.parse(new Date)/1e3}function u(e,t){return parseInt(Math.random()*(t-e+1)+e,10)}function s(e){return 0===e?v:.33*e+.67}function f(e){var t=new XMLHttpRequest;return new Promise(function(r,n){t.open("GET",e,!0),t.responseType="arraybuffer",t.timeout=3e3,t.onload=function(e){206===t.status?r():n()},t.onerror=function(e){n()},t.ontimeout=function(e){n()},t.setRequestHeader("Range","bytes=0-0"),t.send()})}function c(){var e=navigator.language||navigator.userLanguage;return e=e.substr(0,2),"zh"===e?"cn":"en"}function l(e){e.then(function(){})}function h(e){return new Promise(function(t){return setTimeout(t,e)})}function p(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}function d(e){var t=g.from(e),r=new g(e.byteLength);return t.copy(r),r}function y(e){var t=e.split("\n"),r=0,n=0,o=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var f=u.value,c=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(f);if(c&&c[1]){r=parseInt(c[1],10);break}}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}var l=!0,h=!1,p=void 0;try{for(var d,y=t[Symbol.iterator]();!(l=(d=y.next()).done);l=!0){d.value.startsWith("#EXTINF")&&n++}}catch(e){h=!0,p=e}finally{try{!l&&y.return&&y.return()}finally{if(h)throw p}}return r+n-1}Object.defineProperty(t,"__esModule",{value:!0}),t.noop=n,t.getQueryParam=o,t.updateQueryStringParam=i,t.getCurrentTs=a,t.randomNum=u,t.calCheckPeersDelay=s,t.performRangeRequest=f,t.navLang=c,t.dontWaitFor=l,t.timeout=h,t.getBrowserRTC=p,t.copyBuffer=d,t.getMaxSequence=y;var g=r(2).Buffer,v=3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(12),i=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=n({},i.default,{METADATA:"metadata",ERROR:"error",SW_PLAYLIST:"SW_PLAYLIST",SW_MEDIA:"SW_MEDIA",SW_GET_MEDIA:"SW_GET_MEDIA",SW_VERSION:"SW_VERSION",LEVEL_LOADED:"LEVEL_LOADED",MANIFEST_PARSED:"MANIFEST_PARSED",FRAG_LOADED:"FRAG_LOADED"}),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={DC_SIGNAL:"SIGNAL",DC_OPEN:"OPEN",DC_REQUEST:"REQUEST",DC_PIECE_NOT_FOUND:"PIECE_NOT_FOUND",DC_PIECE_ABORT:"PIECE_ABORT",DC_CLOSE:"CLOSE",DC_RESPONSE:"RESPONSE",DC_ERROR:"ERROR",DC_PIECE:"PIECE",DC_TIMEOUT:"TIMEOUT",DC_PIECE_ACK:"PIECE_ACK",DC_METADATA:"METADATA",DC_PLAT_ANDROID:"ANDROID",DC_PLAT_IOS:"IOS",DC_PLAT_WEB:"WEB",DC_CHOKE:"CHOKE",DC_UNCHOKE:"UNCHOKE",DC_HAVE:"HAVE",DC_LOST:"LOST",DC_GET_PEERS:"GET_PEERS",DC_PEERS:"PEERS",DC_STATS:"STATS",DC_SUBSCRIBE:"SUBSCRIBE",DC_UNSUBSCRIBE:"UNSUBSCRIBE",DC_SUBSCRIBE_ACCEPT:"SUBSCRIBE_ACCEPT",DC_SUBSCRIBE_REJECT:"SUBSCRIBE_REJECT",DC_SUBSCRIBE_LEVEL:"SUBSCRIBE_LEVEL",DC_PEER_SIGNAL:"PEER_SIGNAL",DC_PLAYLIST:"PLAYLIST",BM_LOST:"lost",BM_ADDED_SEG_:"BM_ADDED_SEG_",BM_ADDED_SN_:"BM_ADDED_SN_",BM_SEG_ADDED:"BM_SEG_ADDED",FRAG_CHANGED:"FRAG_CHANGED",FRAG_LOADED:"FRAG_LOADED",FRAG_LOADING:"FRAG_LOADING",RESTART_P2P:"RESTART_P2P",EXCEPTION:"exception"},e.exports=t.default},function(e,t,r){"use strict";function n(e){if(!e)return{};var t=e.trim().toLowerCase();if(!t.startsWith("bytes="))throw new Error("unit-must-be-bytes",{normalizedRangeHeader:t});if(t.includes(","))throw new Error("single-range-only",{normalizedRangeHeader:t});var r=/(\d*)-(\d*)/.exec(t);if(!r||!r[1]&&!r[2])throw new Error("invalid-range-values",{normalizedRangeHeader:t});return{start:""===r[1]?void 0:Number(r[1]),end:""===r[2]?void 0:Number(r[2])}}function o(e){var t=u.parseURL(e);return t.path.substring(t.path.lastIndexOf(".")+1)}function i(e){var t=new Headers;return e&&t.set("range",e),t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseRangeHeader=n,t.getUrlSuffix=o,t.makeHeadersWithRange=i;var a=r(14),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a)},function(e,t,r){"use strict";(function(e){var r,n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i){var a=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,u=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=c.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=c.normalizePath(n.path),c.buildURLFromParts(n)}var o=c.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return r.alwaysNormalize?(o.path=c.normalizePath(o.path),c.buildURLFromParts(o)):t;var i=c.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");if(!i.netLoc&&i.path&&"/"!==i.path[0]){var a=u.exec(i.path);i.netLoc=a[1],i.path=a[2]}i.netLoc&&!i.path&&(i.path="/");var s={scheme:i.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(s.netLoc=i.netLoc,"/"!==o.path[0]))if(o.path){var f=i.path,l=f.substring(0,f.lastIndexOf("/")+1)+o.path;s.path=c.normalizePath(l)}else s.path=i.path,o.params||(s.params=i.params,o.query||(s.query=i.query));return null===s.path&&(s.path=r.alwaysNormalize?c.normalizePath(o.path):o.path),c.buildURLFromParts(s)},parseURL:function(e){var t=a.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(f,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};"object"===o(t)&&"object"===o(e)?e.exports=c:(r=[],void 0!==(n=function(){return c}.apply(t,r))&&(e.exports=n))}()}).call(t,r(1)(e))}])});